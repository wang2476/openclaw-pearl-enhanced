server:
  port: 8080
  host: 127.0.0.1  # Changed from 0.0.0.0 for security - binds to localhost only
  cors: true
  auth:
    enabled: false  # Set to true to require API key authentication
    # api_key: ${PEARL_API_KEY}  # Or set directly (not recommended)
    # header_name: x-api-key  # Header name for API key (default: x-api-key)

memory:
  store: sqlite
  path: ./pearl-data/memories.db

extraction:
  enabled: true
  model: ollama/DeepSeek-R1:8b
  async: true
  min_confidence: 0.7
  extract_from_assistant: false
  dedup_window_seconds: 300

embedding:
  provider: ollama
  model: nomic-embed-text
  dimensions: 768

retrieval:
  max_memories: 10
  min_similarity: 0.5
  token_budget: 500
  recency_boost: true

routing:
  classifier: anthropic/claude-haiku-4-5
  defaultModel: anthropic/claude-sonnet-4-5

  # Fallback chains for reliability (ClawRouter-inspired)
  fallback:
    ollama/DeepSeek-R1:8b:
      - anthropic/claude-haiku-4-5
    ollama/DeepSeek-R1:32B:
      - anthropic/claude-sonnet-4-5
      - anthropic/claude-haiku-4-5
    anthropic/claude-sonnet-4-5:
      - anthropic/claude-haiku-4-5
      - ollama/DeepSeek-R1:8b
    anthropic/claude-haiku-4-5:
      - ollama/DeepSeek-R1:8b

  rules:
    # Priority 7: Large context (>100k tokens) - route to Sonnet for quality
    - name: large-context-to-sonnet
      match:
        estimatedTokens: ">100000"
      model: anthropic/claude-sonnet-4-5
      priority: 7

    # Priority 6: Complex reasoning/analysis - route to DeepSeek-R1
    - name: reasoning-to-deepseek
      match:
        type: analysis
        complexity: high
      model: ollama/DeepSeek-R1:32B
      priority: 6

    # Priority 5: Sensitive data - always local
    - name: sensitive-to-local
      match:
        sensitive: true
      model: ollama/DeepSeek-R1:8b
      priority: 5

    # Priority 4: Short simple queries - local Ollama
    - name: short-to-ollama
      match:
        complexity: low
        estimatedTokens: "<500"
      model: ollama/DeepSeek-R1:8b
      priority: 4

    # Priority 3: Code tasks - Sonnet for quality
    - name: code-to-sonnet
      match:
        type: code
      model: anthropic/claude-sonnet-4-5
      priority: 3

    # Priority 2: Medium complexity - Haiku for balance
    - name: medium-to-haiku
      match:
        complexity: medium
      model: anthropic/claude-haiku-4-5
      priority: 2

    # Priority 1: Default fallback
    - name: default
      match:
        default: true
      model: anthropic/claude-sonnet-4-5
      priority: 1

backends:
  anthropic:
    # SECURITY: Use environment variables for API keys
    # Set these before running: export ANTHROPIC_API_KEY=sk-ant-...
    api_key: ${ANTHROPIC_API_KEY}
  openai:
    # SECURITY: Use environment variables for API keys
    # Set these before running: export OPENAI_API_KEY=sk-proj-...
    api_key: ${OPENAI_API_KEY}
  ollama:
    base_url: http://localhost:11434

logging:
  level: info
  file: ./pearl-data/pearl.log
